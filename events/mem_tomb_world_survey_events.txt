namespace = mem_tomb_survey

# Starts Sequence:

event = {
	id = mem_tomb_survey.0
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		every_country = {
			limit = {
				is_ai = no
			}
			country_event = { id = mem_tomb_survey.1 days = 10800 random = 3600 }
		}
	}
}

country_event = {
	id = mem_tomb_survey.1
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = MEM_Our_Country
		
		if = {
			limit = {
				is_ai = no
				NOT = {
					has_country_flag = mem_midgame_survey_quest_started
				}
			}
			# Look for targets:
		
			random_planet = {
				limit = {
					OR = {
						is_planet_class = pc_nuked
						has_modifier = nuclear_devastation
					}
					is_surveyed = {
						who = event_target:MEM_Our_Country
						status = yes
					}
					NOT = {
						OR = {
							has_modifier = ship_graveyard
							has_planet_flag = mem_tomb_world_already_told
							has_planet_flag = mem_tomb_survey_1
							has_planet_flag = mem_tomb_survey_2
							has_planet_flag = mem_tomb_survey_3
							has_planet_flag = mem_tomb_survey_4
						}
					}
				}
				set_planet_flag = mem_tomb_survey_1
			}
			random_planet = {
				limit = {
					OR = {
						is_planet_class = pc_nuked
						has_modifier = nuclear_devastation
					}
					is_surveyed = {
						who = event_target:MEM_Our_Country
						status = yes
					}
					NOT = {
						OR = {
							has_modifier = ship_graveyard
							has_planet_flag = mem_tomb_world_already_told
							has_planet_flag = mem_tomb_survey_1
							has_planet_flag = mem_tomb_survey_2
							has_planet_flag = mem_tomb_survey_3
							has_planet_flag = mem_tomb_survey_4
						}
					}
				}
				set_planet_flag = mem_tomb_survey_2
			}
			random_planet = {
				limit = {
					OR = {
						is_planet_class = pc_nuked
						has_modifier = nuclear_devastation
					}
					is_surveyed = {
						who = event_target:MEM_Our_Country
						status = yes
					}
					NOT = {
						OR = {
							has_modifier = ship_graveyard
							has_planet_flag = mem_tomb_world_already_told
							has_planet_flag = mem_tomb_survey_1
							has_planet_flag = mem_tomb_survey_2
							has_planet_flag = mem_tomb_survey_3
							has_planet_flag = mem_tomb_survey_4
						}
					}
				}
				set_planet_flag = mem_tomb_survey_3
			}
			random_planet = {
				limit = {
					OR = {
						is_planet_class = pc_nuked
						has_modifier = nuclear_devastation
					}
					is_surveyed = {
						who = event_target:MEM_Our_Country
						status = yes
					}
					NOT = {
						OR = {
							has_modifier = ship_graveyard
							has_planet_flag = mem_tomb_world_already_told
							has_planet_flag = mem_tomb_survey_1
							has_planet_flag = mem_tomb_survey_2
							has_planet_flag = mem_tomb_survey_3
							has_planet_flag = mem_tomb_survey_4
						}
					}
				}
				set_planet_flag = mem_tomb_survey_4
			}
		
		# If targets found, proceed:
			if = {
				limit = {
					any_system = {
						any_planet = {
							has_planet_flag = mem_tomb_survey_1
						}
					}
					any_system = {
						any_planet = {
							has_planet_flag = mem_tomb_survey_2
						}
					}
					any_system = {
						any_planet = {
							has_planet_flag = mem_tomb_survey_3
						}
					}
					any_system = {
						any_planet = {
							has_planet_flag = mem_tomb_survey_4
						}
					}
				}
				country_event = { id = mem_tomb_survey.2 }
				else = {
					random_planet = {
						limit = {
							has_planet_flag = mem_tomb_survey_1
						}
						remove_planet_flag = mem_tomb_survey_1
					}
					random_planet = {
						limit = {
							has_planet_flag = mem_tomb_survey_2
						}
						remove_planet_flag = mem_tomb_survey_2
					}
					random_planet = {
						limit = {
							has_planet_flag = mem_tomb_survey_3
						}
						remove_planet_flag = mem_tomb_survey_3
					}
					random_planet = {
						limit = {
							has_planet_flag = mem_tomb_survey_4
						}
						remove_planet_flag = mem_tomb_survey_4
					}
					country_event = { id = mem_tomb_survey.1 days = 360 }
				}
			}
		}
	}
}

# Offer Tomb World Survey to player:

country_event = {
	id = mem_tomb_survey.2
	title = mem_tomb_survey.2.title
	desc = mem_tomb_survey.2.desc
	picture = GFX_evt_society_research
	show_sound = event_scanner
	is_triggered_only = yes
	
	immediate = {
		random_planet = {
			limit = {
				has_planet_flag = mem_tomb_survey_1
			}
			save_event_target_as = mem_tomb_survey_planet_1
			remove_planet_flag = mem_tomb_survey_1
			set_planet_flag = mem_tomb_survey_1_ready
		}
		random_planet = {
			limit = {
				has_planet_flag = mem_tomb_survey_2
			}
			save_event_target_as = mem_tomb_survey_planet_2
			remove_planet_flag = mem_tomb_survey_2
			set_planet_flag = mem_tomb_survey_2_ready
		}
		random_planet = {
			limit = {
				has_planet_flag = mem_tomb_survey_3
			}
			save_event_target_as = mem_tomb_survey_planet_3
			remove_planet_flag = mem_tomb_survey_3
			set_planet_flag = mem_tomb_survey_3_ready
		}
		random_planet = {
			limit = {
				has_planet_flag = mem_tomb_survey_4
			}
			save_event_target_as = mem_tomb_survey_planet_4
			remove_planet_flag = mem_tomb_survey_4
			set_planet_flag = mem_tomb_survey_4_ready
		}
	}

	option = { # Yes
		name = mem_tomb_survey.2.a
		begin_event_chain = {
			event_chain = mem_tomb_world_survey
			target = root
		}
		hidden_effect = {
			set_country_flag = mem_midgame_survey_quest_started
			
			random_planet = {
				limit = {
					has_planet_flag = mem_tomb_survey_1_ready
				}
				save_event_target_as = mem_target_planet
				enable_special_project = {
					name = MEM_TOMB_SURVEY_PROJECT
					location = this
					owner = root
				}
				remove_planet_flag = mem_tomb_survey_1_ready
			}
			random_planet = {
				limit = {
					has_planet_flag = mem_tomb_survey_2_ready
				}
				save_event_target_as = mem_target_planet
				enable_special_project = {
					name = MEM_TOMB_SURVEY_PROJECT
					location = this
					owner = root
				}
				remove_planet_flag = mem_tomb_survey_2_ready
			}
			random_planet = {
				limit = {
					has_planet_flag = mem_tomb_survey_3_ready
				}
				save_event_target_as = mem_target_planet
				enable_special_project = {
					name = MEM_TOMB_SURVEY_PROJECT
					location = this
					owner = root
				}
				remove_planet_flag = mem_tomb_survey_3_ready
			}
			random_planet = {
				limit = {
					has_planet_flag = mem_tomb_survey_4_ready
				}
				save_event_target_as = mem_target_planet
				enable_special_project = {
					name = MEM_TOMB_SURVEY_PROJECT
					location = this
					owner = root
				}
				remove_planet_flag = mem_tomb_survey_4_ready
			}
		}
	}
	
	option = { # No
		name = mem_tomb_survey.2.b
	}
}

# Survey Completed, Pick Outcome:

ship_event = {
	id = mem_tomb_survey.10
	hide_window = yes
	is_triggered_only = yes
	location = FROMFROM
	
	immediate = {
		random_list = {
			1 = { # Religious War
				modifier = {
					owner = {
						has_country_flag = mem_tomb_survey_1_fired
					}
					factor = 0
				}
				owner = {
					country_event = { id = mem_tomb_survey.11 }
				}
			}
			1 = { # Asteroid Impact
				modifier = {
					owner = {
						has_country_flag = mem_tomb_survey_2_fired
					}
					factor = 0
				}
				modifier = {
					FROMFROM = {
						OR = {
							has_modifier = nuclear_devastation
							has_planet_flag = mem_nuke_war_site
						}
					}
					factor = 0
				}
				owner = {
					country_event = { id = mem_tomb_survey.12 }
				}
			}
			1 = { # Science Accident
				modifier = {
					owner = {
						has_country_flag = mem_tomb_survey_3_fired
					}
					factor = 0
				}
				modifier = {
					FROMFROM = {
						OR = {
							has_modifier = nuclear_devastation
							has_planet_flag = mem_nuke_war_site
						}
					}
					factor = 0
				}
				owner = {
					country_event = { id = mem_tomb_survey.13 }
				}
			}
			1 = { # Alien Attack
				modifier = {
					owner = {
						has_country_flag = mem_tomb_survey_4_fired
					}
					factor = 0
				}
				modifier = {
					FROMFROM = {
						has_planet_flag = mem_nuke_war_site
					}
					factor = 0
				}
				owner = {
					country_event = { id = mem_tomb_survey.14 }
				}
			}
			1 = { # Accidental War
				modifier = {
					owner = {
						has_country_flag = mem_tomb_survey_5_fired
					}
					factor = 0
				}
				owner = {
					country_event = { id = mem_tomb_survey.15 }
				}
			}
			1 = { # Deliberate Suicide
				modifier = {
					owner = {
						has_country_flag = mem_tomb_survey_6_fired
					}
					factor = 0
				}
				modifier = {
					FROMFROM = {
						has_planet_flag = mem_nuke_war_site
					}
					factor = 0
				}
				owner = {
					country_event = { id = mem_tomb_survey.16 }
				}
			}
		}
	}
}

# Religious War:

country_event = {
	id = mem_tomb_survey.11
	title = mem_tomb_survey.11.title
	desc = mem_tomb_survey.11.desc
	picture = GFX_evt_mem_nuke_2
	show_sound = event_scanner
	is_triggered_only = yes
	
	immediate = {
		set_country_flag = mem_tomb_survey_1_fired
		add_event_chain_counter = {
			event_chain = "mem_tomb_world_survey"
			counter = "mem_tomb_worlds_surveyed"
			amount = 1
		}
	}
	
	option = {
		name = mem_tomb_survey.11.a
		add_monthly_resource_mult = {
			resource = society_research
			value = 18
			min = 120
			max = 350
		}
		hidden_effect = {
			if = {
				limit = {
					has_completed_event_chain_counter = {
						event_chain = mem_tomb_world_survey
						counter = mem_tomb_worlds_surveyed
					}
				}
				country_event = { id = mem_tomb_survey.20 days = 4 }
			}
		}
	}
}

# Asteroid Impact:

country_event = {
	id = mem_tomb_survey.12
	title = mem_tomb_survey.12.title
	desc = mem_tomb_survey.12.desc
	picture = GFX_evt_nuclear_explosion
	show_sound = event_scanner
	is_triggered_only = yes
	
	immediate = {
		set_country_flag = mem_tomb_survey_2_fired
		add_event_chain_counter = {
			event_chain = "mem_tomb_world_survey"
			counter = "mem_tomb_worlds_surveyed"
			amount = 1
		}
	}
	
	option = {
		name = mem_tomb_survey.12.a
		add_monthly_resource_mult = {
			resource = society_research
			value = 18
			min = 120
			max = 350
		}
		hidden_effect = {
			if = {
				limit = {
					has_completed_event_chain_counter = {
						event_chain = mem_tomb_world_survey
						counter = mem_tomb_worlds_surveyed
					}
				}
				country_event = { id = mem_tomb_survey.20 days = 4 }
			}
		}
	}
}

# Science Accident

country_event = {
	id = mem_tomb_survey.13
	title = mem_tomb_survey.13.title
	desc = mem_tomb_survey.13.desc
	picture = GFX_evt_mem_nuke_1
	show_sound = event_scanner
	is_triggered_only = yes
	
	immediate = {
		set_country_flag = mem_tomb_survey_3_fired
		add_event_chain_counter = {
			event_chain = "mem_tomb_world_survey"
			counter = "mem_tomb_worlds_surveyed"
			amount = 1
		}
	}
	
	option = {
		name = mem_tomb_survey.13.a
		add_monthly_resource_mult = {
			resource = society_research
			value = 12
			min = 90
			max = 250
		}
		add_monthly_resource_mult = {
			resource = physics_research
			value = 12
			min = 90
			max = 250
		}
		hidden_effect = {
			if = {
				limit = {
					has_completed_event_chain_counter = {
						event_chain = mem_tomb_world_survey
						counter = mem_tomb_worlds_surveyed
					}
				}
				country_event = { id = mem_tomb_survey.20 days = 4 }
			}
		}
	}
}

# Murder

country_event = {
	id = mem_tomb_survey.14
	title = mem_tomb_survey.14.title
	desc = mem_tomb_survey.14.desc
	picture = GFX_evt_mem_nuke_2
	show_sound = event_scanner
	is_triggered_only = yes
	
	immediate = {
		set_country_flag = mem_tomb_survey_4_fired
		add_event_chain_counter = {
			event_chain = "mem_tomb_world_survey"
			counter = "mem_tomb_worlds_surveyed"
			amount = 1
		}
	}
	
	option = {
		name = mem_tomb_survey.14.a
		add_monthly_resource_mult = {
			resource = society_research
			value = 18
			min = 120
			max = 350
		}
		hidden_effect = {
			if = {
				limit = {
					has_completed_event_chain_counter = {
						event_chain = mem_tomb_world_survey
						counter = mem_tomb_worlds_surveyed
					}
				}
				country_event = { id = mem_tomb_survey.20 days = 4 }
			}
		}
	}
}

# Accidental War

country_event = {
	id = mem_tomb_survey.15
	title = mem_tomb_survey.15.title
	desc = mem_tomb_survey.15.desc
	picture = GFX_evt_mem_nuke_2
	show_sound = event_scanner
	is_triggered_only = yes
	
	immediate = {
		set_country_flag = mem_tomb_survey_5_fired
		add_event_chain_counter = {
			event_chain = "mem_tomb_world_survey"
			counter = "mem_tomb_worlds_surveyed"
			amount = 1
		}
	}
	
	option = {
		name = mem_tomb_survey.15.a
		add_monthly_resource_mult = {
			resource = society_research
			value = 18
			min = 120
			max = 350
		}
		hidden_effect = {
			if = {
				limit = {
					has_completed_event_chain_counter = {
						event_chain = mem_tomb_world_survey
						counter = mem_tomb_worlds_surveyed
					}
				}
				country_event = { id = mem_tomb_survey.20 days = 4 }
			}
		}
	}
}

# Accidental War

country_event = {
	id = mem_tomb_survey.16
	title = mem_tomb_survey.16.title
	desc = mem_tomb_survey.16.desc
	picture = GFX_evt_mem_nuke_2
	show_sound = event_scanner
	is_triggered_only = yes
	
	immediate = {
		set_country_flag = mem_tomb_survey_6_fired
		add_event_chain_counter = {
			event_chain = "mem_tomb_world_survey"
			counter = "mem_tomb_worlds_surveyed"
			amount = 1
		}
	}
	
	option = {
		name = mem_tomb_survey.16.a
		add_monthly_resource_mult = {
			resource = society_research
			value = 18
			min = 120
			max = 350
		}
		hidden_effect = {
			if = {
				limit = {
					has_completed_event_chain_counter = {
						event_chain = mem_tomb_world_survey
						counter = mem_tomb_worlds_surveyed
					}
				}
				country_event = { id = mem_tomb_survey.20 days = 4 }
			}
		}
	}
}

# Event Chain Completed:

country_event = {
	id = mem_tomb_survey.20
	title = mem_tomb_survey.20.title
	picture = GFX_evt_society_research
	show_sound = event_scanner
	is_triggered_only = yes

	immediate = {
		random_owned_leader = {
			limit = {
				is_researching_area = society
			}
			save_event_target_as = MEM_society_scientist
		}
	}

	desc = {
		trigger = {
			OR = {
				has_ethic = ethic_spiritualist
				has_ethic = ethic_fanatic_spiritualist
			}
		}
		text = mem_tomb_survey.20.desc_spiritual
	}
	
	desc = {
		trigger = {
			NOT = {
				OR = {
					has_ethic = ethic_spiritualist
					has_ethic = ethic_fanatic_spiritualist
				}
			}
		}
		text = mem_tomb_survey.20.desc_material
	}
	
	immediate = {
		if = {
			limit = {
				OR = {
					has_ethic = ethic_spiritualist
					has_ethic = ethic_fanatic_spiritualist
				}
			}
			set_country_flag = mem_can_build_cathedral_of_dead_gods
			else = {
				set_country_flag = mem_can_build_archive_of_dead_worlds
			}
		}
	}
	
	option = {
		name = mem_tomb_survey.20.a
		add_monthly_resource_mult = {
			resource = society_research
			value = 30
			min = 360
			max = 600
		}
		end_event_chain = mem_tomb_world_survey
	}
}
