########################
# Sleepers
# Code by Malthus
# Text by ViolentBeetle
########################

namespace = mem_sleepers

@tier1materialreward = 6
@tier1materialmin = 100
@tier1materialmax = 500
@tier2materialreward = 12
@tier2materialmin = 150
@tier2materialmax = 1000
@tier3materialreward = 18
@tier3materialmin = 250
@tier3materialmax = 1500
@tier4materialreward = 24
@tier4materialmin = 350
@tier4materialmax = 2000

@tier1influencereward = 6
@tier1influencemin = 40
@tier1influencemax = 100
@tier2influencereward = 12
@tier2influencemin = 80
@tier2influencemax = 175
@tier3influencereward = 18
@tier3influencemin = 125
@tier3influencemax = 250
@tier4influencereward = 24
@tier4influencemin = 150
@tier4influencemax = 300

@tier1researchreward = 6
@tier1researchmin = 60
@tier1researchmax = 150
@tier2researchreward = 12
@tier2researchmin = 90
@tier2researchmax = 250
@tier3researchreward = 18
@tier3researchmin = 120
@tier3researchmax = 350
@tier4researchreward = 24
@tier4researchmin = 150
@tier4researchmax = 500

################################################################################
################################################################################
################################################################################
 
# Happens on planet with obervation post with either passive or active observation

# Sleepers setup (HIDDEN)
planet_event = {
	id = mem_sleepers.1
	hide_window = yes
	
	trigger = {
		has_observation_outpost = yes
		observation_outpost = { 
			OR = { 
				has_mission = passive_observation
				has_mission = specimen_collection
			}
		}
		observation_outpost_owner = {
			AND = { 
				NOT = { has_country_flag = mem_sleepers_chain }
				is_ai = no
			}
		}
		owner = {
			is_country_type = primitive
			OR = {
				has_country_flag = bronze_age
				has_country_flag = iron_age
				has_country_flag = late_medieval_age
				has_country_flag = renaissance_age
			}
		}
		NOT = { has_planet_flag = mem_sleepers_planet }
	}
	
	mean_time_to_happen = {
		#months = 5000
		months = 1
	}
	
	immediate = {
		observation_outpost_owner = {
			limit = { 
				is_ai = no
				NOT = { has_country_flag = mem_sleepers_chain }
			}
			country_event = { id = mem_sleepers.2 }
		}
		set_planet_flag = mem_sleepers_planet
	}
}

country_event = {
	id = mem_sleepers.2
	title = mem_sleepers.2.name
	desc = mem_sleepers.2.desc
	picture = GFX_evt_satellite_in_orbit
	location = FROM
	
	is_triggered_only = yes
	
	option = {
		name = mem_sleepers.2.a
		random_system_within_border = {
			limit = {
				any_planet = {
					has_planet_flag = mem_sleepers_planet
				}
			}
			random_planet = {
				limit = {
					has_planet_flag = mem_sleepers_planet
				}
				enable_special_project = {
					name = "MEM_SLEEPERS_SCAN"
					location = THIS
					owner = ROOT
				}
			}
		}
	}
}

# Failed to do the project (Soft Fail)
country_event = {
	id = mem_sleepers.3
	title = mem_sleepers.3.name
	desc = mem_sleepers.3.desc
	picture = GFX_evt_nuclear_explosion
	location = FROMFROMFROM
	
	is_triggered_only = yes

	immediate = {
		random_system_within_border = {
			limit = {
				any_planet = {
					has_planet_flag = mem_sleepers_planet
				}
			}
			random_planet = {
				limit = {
					has_planet_flag = mem_sleepers_planet
				}
				random_tile =  {
					limit = {
						has_blocker = no
						has_grown_pop = no
						has_building = no
					}
					set_blocker = tb_bomb_crater
				}
				owner = {
					IF = {
						limit = {
							NOR = {
								has_ethic = ethic_fanatic_spiritualist
								has_ethic = ethic_spiritualist
								has_ethic = ethic_fanatic_materialist
								has_ethic = ethic_materialist
							}
						}
						country_add_ethic = ethic_spiritualist
						every_owned_pop = {
							pop_add_ethic = ethic_spiritualist
						}
					}
					IF = {
						limit = {
							has_ethic = ethic_fanatic_materialist	
						}
						country_remove_ethic = ethic_fanatic_materialist
						country_add_ethic = ethic_fanatic_spiritualist
						every_owned_pop = {
							pop_remove_ethic = ethic_fanatic_materialist
							pop_add_ethic = ethic_fanatic_spiritualist
						}
					}
					IF = {
						limit = {
							has_ethic = ethic_materialist	
						}
						country_remove_ethic = ethic_materialist
						country_add_ethic = ethic_spiritualist
						every_owned_pop = {
							pop_remove_ethic = ethic_materialist
							pop_add_ethic = ethic_spiritualist
						}
					}
				}
			}
		}
	}
	
	option = {
		name = "mem_sleepers.3.a"
	}
}

# Failed to do the project (Hard Fail)
country_event = {
	id = mem_sleepers.4
	title = mem_sleepers.4.name
	desc = mem_sleepers.4.desc
	picture = GFX_evt_nuclear_explosion
	location = FROMFROMFROM
	
	is_triggered_only = yes

	immediate = {
		random_system_within_border = {
			limit = {
				any_planet = {
					has_planet_flag = mem_sleepers_planet
				}
			}
			random_planet = {
				limit = {
					has_planet_flag = mem_sleepers_planet
				}
				observation_outpost = {
					dismantle = yes
				}
				destroy_colony = yes
				change_pc = pc_nuked
				random_tile = {
					limit = { 
						has_blocker = no
						num_adjacent_tiles > 3
					}
					set_blocker = tb_bomb_crater
					random_neighboring_tile = {
						limit = {
							has_blocker = no
						}
						set_blocker = tb_radioactive_wasteland
					}
					random_neighboring_tile = {
						limit = {
							has_blocker = no
						}
						set_blocker = tb_radioactive_wasteland
					}
					random_neighboring_tile = {
						limit = {
							has_blocker = no
						}
						set_blocker = tb_radioactive_wasteland
					}
					random_neighboring_tile = {
						limit = {
							has_blocker = no
						}
						set_blocker = tb_radioactive_wasteland
					}
				}
				random_tile = {
					limit = { 
						has_blocker = no
					}
					set_blocker = tb_active_volcano
				}
				random_tile = {
					limit = { 
						has_blocker = no
					}
					set_blocker = tb_active_volcano
				}
				random_tile = {
					limit = { 
						has_blocker = no
					}
					set_blocker = tb_active_volcano
				}
			}
		}
	}
	
	option = {
		name = "mem_sleepers.4.a"
		trigger = {       
			NOT = {
				has_ethic = "ethic_fanatic_xenophobe"
			}
		}
	}
	
	option = {
		name = "mem_sleepers.4.b"
		trigger = {
			has_ethic = "ethic_fanatic_xenophobe"
		}
	}
}

ship_event = {
	id = mem_sleepers.5
	title = mem_sleepers.5.name
	desc = mem_sleepers.5.desc
	picture = GFX_evt_mem_horror_corridor
	location = FROMFROMFROM
	
	is_triggered_only = yes
	
	immediate = {
		solar_system = {
			random_system_planet = {
				limit = {
					has_planet_flag = mem_sleepers_planet
				}
				random_pop = {
					save_event_target_as = mem_sleepers_natives
				}
			}
		}
	}
	
	option = {
		name = mem_sleepers.5.a
		custom_tooltip = mem_sleepers.5.a.tooltip
		trigger = {
			owner = {
				energy > 499
			}
		}
		add_energy = -500
	}
	option = {
		name = mem_sleepers.5.a
		custom_tooltip = mem_sleepers.5.b.tooltip
		trigger = {
			owner = {
				energy < 500
			}
		}
		owner = {
			add_modifier = {
				modifier = mem_sleepers_energy_cost
				days = 1500
			}
		}
	}
}