namespace = mem_lex_init

country_event = {
	id = mem_lex_init.1
	hide_window = yes

	trigger = {
		is_ai = no
		is_country_type = default
		NOT = {
			has_country_flag = mem_lex_unlock
			AND = {
				has_global_flag = mem_ring_lock
				has_global_flag = mem_grave_lock
				has_global_flag = mem_garden_lock	
			}
		}
		has_technology = "tech_sensors_3"
	}
	
	mean_time_to_happen = {
		years = 50

		modifier = {
			factor = 0.5
				any_country = {
					has_country_flag = awakened_fallen_empire
				}	
		}
		modifier = {
			factor = 0.25
				has_global_flag = ai_revolt_happened
		}
		modifier = {
			factor = 0.25
				has_global_flag = prethoryn_invasion_happened
		}
		modifier = {
			factor = 0.25
				has_global_flag = extradimensional_invasion_happened
		}
		modifier = {
			factor = 0.1
				has_country_flag = vultaum_world_found
		}
		modifier = {
			factor = 0.1
				has_country_flag = yuht_homeworld_found
		}
		modifier = {
			factor = 0.1
				has_country_flag = league_world_found
		}
		modifier = {
			factor = 0.1
				has_country_flag = irassian_world_found
		}
		modifier = {
			factor = 0.1
				has_country_flag = cybrex_world_found
		}
		modifier = {
			factor = 0.01
				has_global_flag = war_in_heaven_started
		}
	}

	immediate = {	
		set_country_flag = mem_lex_unlock
		country_event = { id = mem_lex_init.2 } 
	}
}

country_event = {
	id = mem_lex_init.2
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			AND = {
				has_global_flag = mem_ring_lock
				has_global_flag = mem_grave_lock
				has_global_flag = mem_garden_lock	
			}
		}
	}

	immediate = {
		random_list = {
			33 = {
				if = {
					limit = {
						NOT = {
							has_global_flag = mem_ring_lock
							any_system = {
								has_star_flag = mem_ring_system
							}
						}
					}
					random_rim_system = {
						limit = {
							NOT = {
								OR = {
									has_star_flag = mem_grave_system
									has_star_flag = mem_garden_system
									has_star_flag = mem_prison_system
									has_star_flag = mem_system_spawn_2
									has_star_flag = mem_system_spawn_3
									has_star_flag = mem_system_spawn_4
								}
								is_fe_cluster = yes
							}
						}
						spawn_system = {
							min_distance = 20
							max_distance = 60
							initializer = "mem_ringworld"
						}
						set_star_flag = mem_system_spawn_1
					}
					set_global_flag = mem_ring_lock
					country_event = { id = mem_lex_init.3 days = 10 } 
					country_event = { id = mem_lex_init.2 days = 1800 }
					else = {
						country_event = { id = mem_lex_init.2 days = 1800 }
					}
				} 
			}
			33 = {
				if = {
					limit = {
						NOT = {
							has_global_flag = mem_grave_lock
							any_system = {
								has_star_flag = mem_grave_system
							}
						}
					}
					random_rim_system = {
						limit = {
							NOT = {
								OR = {
									has_star_flag = mem_ring_system
									has_star_flag = mem_garden_system
									has_star_flag = mem_prison_system
									has_star_flag = mem_system_spawn_1
									has_star_flag = mem_system_spawn_3
									has_star_flag = mem_system_spawn_4
								}
								is_fe_cluster = yes
							}
						}
						spawn_system = {
							min_distance = 20
							max_distance = 60
							initializer = "mem_graveyard"
						}
						set_star_flag = mem_system_spawn_2
					}
					set_global_flag  = mem_grave_lock
					country_event = { id = mem_lex_init.4 days = 10 } 
					country_event = { id = mem_lex_init.2 days = 1800 }
					else = {
						country_event = { id = mem_lex_init.2 days = 1800 }
					}
				}
			}
			33 = {
				if = {
					limit = {
						NOT = {
							has_global_flag = mem_garden_lock
							any_system = {
								has_star_flag = mem_garden_system
							}
						}
					}
					random_rim_system = {
						limit = {
							NOT = {
								OR = {
									has_star_flag = mem_ring_system
									has_star_flag = mem_grave_system
									has_star_flag = mem_prison_system
									has_star_flag = mem_system_spawn_1
									has_star_flag = mem_system_spawn_2
									has_star_flag = mem_system_spawn_4
								}
								is_fe_cluster = yes
							}
						}
						spawn_system = {
							min_distance = 20
							max_distance = 60
							initializer = "mem_garden"
						}
						set_star_flag = mem_system_spawn_3
					}
					set_global_flag  = mem_garden_lock
					country_event = { id = mem_lex_init.5 days = 10 } 
					country_event = { id = mem_lex_init.2 days = 1800 }
					else = {
						country_event = { id = mem_lex_init.2 days = 1800 }
					}
				}
			}
			1 = {
				country_event = { id = mem_lex_init.2 days = 1800 }
			}
		}
	}
}

# Ringworld

country_event = {
	id = mem_lex_init.3
	title = "mem_lex_init.3.name"
	desc = "mem_lex_init.3.desc"
	picture = GFX_evt_wormhole
	show_sound = event_sensor_ping
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_event_chain = "mem_lex_ring_chain" 
		}
	}

	immediate = {
		random_system = {
			limit = {
				has_star_flag = mem_ring_system 
			}
			save_event_target_as = mem_ring_poi
		}
	}
	
	option = {
		name = "mem_lex_init.3.a"
		begin_event_chain = {
			event_chain = "mem_lex_ring_chain"
			target = ROOT
		}
		create_point_of_interest = {
			id = mem_lex_init_poi.1
			name = "mem_ring_guardian_poi"
			desc = "mem_ring_guardian_poi_desc"
			event_chain = mem_lex_ring_chain
			location = event_target:mem_ring_poi
		}
	}
}

# Graveyard

country_event = {
	id = mem_lex_init.4
	title = "mem_lex_init.4.name"
	desc = "mem_lex_init.4.desc"
	picture = GFX_evt_wormhole
	show_sound = event_sensor_ping
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_event_chain = "mem_lex_grave_chain"
		}
		
	}

	immediate = {
		random_system = {
			limit = {
				has_star_flag = mem_grave_system 
			}
			save_event_target_as = mem_grave_poi
		}
	}
	
	option = {
		name = "mem_lex_init.4.a"
		begin_event_chain = {
			event_chain = "mem_lex_grave_chain"
			target = ROOT
		}
		create_point_of_interest = {
			id = mem_lex_init_poi.2
			name = "mem_grave_guardian_poi"
			desc = "mem_grave_guardian_poi_desc"
			event_chain = mem_lex_grave_chain
			location = event_target:mem_grave_poi
		}
	}
}

# Arcadia

country_event = {
	id = mem_lex_init.5
	title = "mem_lex_init.5.name"
	desc = "mem_lex_init.5.desc"
	picture = GFX_evt_wormhole
	show_sound = event_sensor_ping
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_event_chain = "mem_lex_garden_chain" 
		}
	}

	immediate = {
		random_system = {
			limit = {
				has_star_flag = mem_garden_system 
			}
			save_event_target_as = mem_garden_poi
		}
	}
	
	option = {
		name = "mem_lex_init.5.a"
		begin_event_chain = {
			event_chain = "mem_lex_garden_chain"
			target = ROOT
		}
		create_point_of_interest = {
			id = mem_lex_init_poi.3
			name = "mem_garden_guardian_poi"
			desc = "mem_garden_guardian_poi_desc"
			event_chain = mem_lex_garden_chain
			location = event_target:mem_garden_poi
		}
	}
}

# Crisis System Init

country_event = {
	id = mem_lex_init.6
	hide_window = yes
	
	fire_only_once = yes
	
	trigger = {
		NOT = {
			has_global_flag = mem_ancestor_system_seed
			any_system = {
				has_star_flag = mem_prison_system
			}
		}
	}

	immediate = {	
		random_system = {
			if = {
				limit = {
					is_fe_cluster = yes
					NOT = {
						has_star_flag = mem_ring_system
						has_star_flag = mem_grave_system
						has_star_flag = mem_garden_system
						has_star_flag = mem_system_spawn_1
						has_star_flag = mem_system_spawn_2
						has_star_flag = mem_system_spawn_3
					}
				}
				spawn_system = {
					min_distance = 20
					max_distance = 60
					initializer = "mem_prison"
				}
				set_star_flag = mem_system_spawn_4
				else = {
					random_rim_system = {
						limit = {
							NOT = {
								has_star_flag = sanctuary_system
								has_star_flag = mem_ring_system
								has_star_flag = mem_grave_system
								has_star_flag = mem_garden_system
								has_star_flag = mem_system_spawn_1
								has_star_flag = mem_system_spawn_2
								has_star_flag = mem_system_spawn_3
							}
						}
						spawn_system = {
							min_distance = 20
							max_distance = 60
							initializer = "mem_prison"
						}
						set_star_flag = mem_system_spawn_4
					}
				}
			}
		}
		set_global_flag = mem_ancestor_system_seed
	}
}