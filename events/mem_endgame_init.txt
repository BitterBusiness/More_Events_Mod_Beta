namespace = mem_endgame

country_event = {
	id = mem_endgame.1
	hide_window = yes
	
	fire_only_once = yes
	
	trigger = {
		is_ai = no
		is_country_type = default
		NOT = {
			has_country_flag = encountered_mem_titan	
			has_country_flag = encountered_mem_grave
			has_country_flag = encountered_mem_conduit
			has_global_flag = mem_endgame_seed
		}
		has_technology = "tech_sensors_4"
	}
	
	mean_time_to_happen = {
		years = 1
		
		modifier = {
			factor = 0.01
				has_country_flag = vultaum_world_found
		}
		modifier = {
			factor = 0.01
				has_country_flag = yuht_homeworld_found
		}
		modifier = {
			factor = 0.01
				has_country_flag = league_world_found
		}
		modifier = {
			factor = 0.01
				has_country_flag = irassian_world_found
		}
		modifier = {
			factor = 0.01
				has_country_flag = cybrex_world_found
		}
		modifier = {
			factor = 0.01
				has_global_flag = galactic_crisis_happened
		}
		modifier = {
			factor = 0.01
				any_country = {
					has_country_flag = awakened_fallen_empire
				}	
		}
	}
	
	immediate = {	
		random_system = {
			limit = {
				NOT = {
					OR = {
						has_star_flag = mem_ring_system
						has_star_flag = mem_grave_system
						has_star_flag = mem_garden_system
						has_star_flag = mem_system_spawn_1
						has_star_flag = mem_system_spawn_2
						has_star_flag = mem_system_spawn_3
					}
					is_fe_cluster = yes
				}
			}
			spawn_system = {
				min_distance = 20
				max_distance = 50
				initializer = "mem_ringworld"
			}
			set_star_flag = mem_system_spawn_1
		}
		random_system = {
			limit = {
				NOT = {
					OR = {
						has_star_flag = mem_ring_system
						has_star_flag = mem_grave_system
						has_star_flag = mem_garden_system
						has_star_flag = mem_system_spawn_1
						has_star_flag = mem_system_spawn_2
						has_star_flag = mem_system_spawn_3
					}
					is_fe_cluster = yes
				}
			}
			spawn_system = {
				min_distance = 20
				max_distance = 50
				initializer = "mem_graveyard"
			}
			set_star_flag = mem_system_spawn_2
		}
		random_system = {
			limit = {
				NOT = {
					OR = {
						has_star_flag = mem_ring_system
						has_star_flag = mem_grave_system
						has_star_flag = mem_garden_system
						has_star_flag = mem_system_spawn_1
						has_star_flag = mem_system_spawn_2
						has_star_flag = mem_system_spawn_3
					}
					is_fe_cluster = yes
				}
			}
			spawn_system = {
				min_distance = 20
				max_distance = 50
				initializer = "mem_garden"
			}
			set_star_flag = mem_system_spawn_3
		}
		set_global_flag = mem_endgame_seed
		country_event = { id = mem_endgame.2 days = 10 } 
	}
}

country_event = {
	id = mem_endgame.2
	title = "mem_endgame.2.name"
	desc = "mem_endgame.2.desc"
	picture = GFX_evt_fallen_empire_awakes
	show_sound = event_activating_unknown_technology
	
	is_triggered_only = yes
	
	fire_only_once = yes
	
	immediate = {
		random_system = {
			limit = { has_star_flag = mem_ring_system }
			save_event_target_as = mem_ring_poi
		}
		random_system = {
			limit = { has_star_flag = mem_grave_system }
			save_event_target_as = mem_grave_poi
		}
		random_system = {
			limit = { has_star_flag = mem_garden_system }
			save_event_target_as = mem_garden_poi
		}
	}
	
	option = {
		name = "mem_endgame.2.a"
		create_point_of_interest = {
			id = mem_endgame_poi.1
			name = "mem_ring_guardian_poi"
			desc = "mem_ring_guardian_poi_desc"
			location = event_target:mem_ring_poi
		}
		create_point_of_interest = {
			id = mem_endgame_poi.2
			name = "mem_grave_guardian_poi"
			desc = "mem_grave_guardian_poi_desc"
			location = event_target:mem_grave_poi
		}
		create_point_of_interest = {
			id = mem_endgame_poi.3
			name = "mem_garden_guardian_poi"
			desc = "mem_garden_guardian_desc"
			location = event_target:mem_garden_poi
		}
	}
}